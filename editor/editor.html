<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Snap Hero - Editor</title>
  <link rel="stylesheet" href="editor.css">
</head>
<body>
  <div class="toolbar">
    <div class="toolbar-left">
      <span class="logo">Snap Hero</span>
    </div>

    <!-- Mobile menu toggle -->
    <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle menu">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/>
      </svg>
    </button>

    <div class="toolbar-center" id="toolbarCenter">
      <!-- Drawing Tools -->
      <div class="tool-group">
        <button class="tool-btn active" data-tool="select" data-tooltip="Select" data-shortcut="S">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"/><path d="M13 13l6 6"/>
          </svg>
        </button>
        <button class="tool-btn" data-tool="pen" data-tooltip="Pencil" data-shortcut="P">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"/>
          </svg>
        </button>
        <button class="tool-btn" data-tool="text" data-tooltip="Text" data-shortcut="T">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="4 7 4 4 20 4 20 7"/><line x1="9" x2="15" y1="20" y2="20"/><line x1="12" x2="12" y1="4" y2="20"/>
          </svg>
        </button>
        <button class="tool-btn" data-tool="rectangle" data-tooltip="Rectangle" data-shortcut="R">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect width="18" height="18" x="3" y="3" rx="2"/>
          </svg>
        </button>
        <button class="tool-btn" data-tool="circle" data-tooltip="Circle" data-shortcut="C">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
          </svg>
        </button>
        <button class="tool-btn" data-tool="arrow" data-tooltip="Arrow" data-shortcut="A">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M5 12h14"/><path d="m12 5 7 7-7 7"/>
          </svg>
        </button>
        <button class="tool-btn" data-tool="blur" data-tooltip="Blur" data-shortcut="B">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M3 15h18"/><path d="M9 3v18"/><path d="M15 3v18"/>
          </svg>
        </button>
      </div>

      <div class="separator"></div>

      <!-- Color Picker -->
      <div class="color-picker-group">
        <div class="color-swatches">
          <button class="color-swatch active" data-color="#ef4444" style="--swatch-color: #ef4444" data-tooltip="Red"></button>
          <button class="color-swatch" data-color="#3b82f6" style="--swatch-color: #3b82f6" data-tooltip="Blue"></button>
          <button class="color-swatch" data-color="#22c55e" style="--swatch-color: #22c55e" data-tooltip="Green"></button>
          <button class="color-swatch" data-color="#eab308" style="--swatch-color: #eab308" data-tooltip="Yellow"></button>
          <button class="color-swatch" data-color="#f97316" style="--swatch-color: #f97316" data-tooltip="Orange"></button>
          <button class="color-swatch" data-color="#a855f7" style="--swatch-color: #a855f7" data-tooltip="Purple"></button>
          <button class="color-swatch" data-color="#ffffff" style="--swatch-color: #ffffff" data-tooltip="White"></button>
          <button class="color-swatch" data-color="#000000" style="--swatch-color: #000000" data-tooltip="Black"></button>
        </div>
        <div class="custom-color-wrapper">
          <input type="color" id="colorPicker" value="#ef4444" data-tooltip="Custom Color">
          <svg class="color-picker-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m2 22 1-1h3l9-9"/><path d="M3 21v-3l9-9"/><path d="m15 6 3.4-3.4a2.1 2.1 0 1 1 3 3L18 9l.4.4a2.1 2.1 0 1 1-3 3l-3.8-3.8a2.1 2.1 0 1 1 3-3l.4.4Z"/>
          </svg>
        </div>
      </div>

      <div class="separator"></div>

      <!-- Line Width (for pen/shapes) -->
      <div class="line-width-group" id="lineWidthGroup">
        <span class="group-label">Stroke</span>
        <button class="option-btn" data-width="2" data-tooltip="Thin (2px)">
          <span class="width-preview thin"></span>
        </button>
        <button class="option-btn active" data-width="4" data-tooltip="Medium (4px)">
          <span class="width-preview medium"></span>
        </button>
        <button class="option-btn" data-width="8" data-tooltip="Thick (8px)">
          <span class="width-preview thick"></span>
        </button>
      </div>

      <!-- Fill Toggle (for rectangle/circle) -->
      <div class="fill-toggle-group" id="fillToggleGroup" style="display: none;">
        <span class="group-label">Fill</span>
        <button class="option-btn active" data-fill="outline" data-tooltip="Outline Only">
          <span class="fill-preview outline"></span>
        </button>
        <button class="option-btn" data-fill="filled" data-tooltip="Filled">
          <span class="fill-preview filled"></span>
        </button>
      </div>

      <!-- Font Size (for text) -->
      <div class="font-size-group" id="fontSizeGroup" style="display: none;">
        <span class="group-label">Size</span>
        <button class="option-btn font-btn" data-size="16" data-tooltip="Small (16px)">S</button>
        <button class="option-btn font-btn active" data-size="24" data-tooltip="Medium (24px)">M</button>
        <button class="option-btn font-btn" data-size="36" data-tooltip="Large (36px)">L</button>
      </div>
    </div>

    <div class="toolbar-right" id="toolbarRight">
      <div class="tool-group">
        <button class="tool-btn" data-tool="undo" data-tooltip="Undo" data-shortcut="Ctrl+Z">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/>
          </svg>
        </button>
        <button class="tool-btn" data-tool="redo" data-tooltip="Redo" data-shortcut="Ctrl+Y">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 7v6h-6"/><path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7"/>
          </svg>
        </button>
      </div>

      <div class="separator"></div>

      <div class="download-dropdown" id="downloadDropdown">
        <button class="action-btn" id="downloadBtn" data-tooltip="Save Image" data-shortcut="Ctrl+S">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/>
          </svg>
          <span class="btn-text">Save</span>
          <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m6 9 6 6 6-6"/>
          </svg>
        </button>
        <div class="dropdown-menu" id="downloadMenu">
          <button class="dropdown-item active" data-format="png">
            <span class="format-name">PNG</span>
            <span class="format-desc">Best Quality</span>
          </button>
          <button class="dropdown-item" data-format="jpeg">
            <span class="format-name">JPEG</span>
            <span class="format-desc">Smaller Size</span>
          </button>
          <div class="quality-slider-group" id="qualityGroup" style="display: none;">
            <label>Quality: <span id="qualityValue">90</span>%</label>
            <input type="range" id="qualitySlider" min="10" max="100" value="90">
          </div>
        </div>
      </div>

      <button class="action-btn secondary" id="copyBtn" data-tooltip="Copy to Clipboard" data-shortcut="Ctrl+C">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
        </svg>
        <span class="btn-text">Copy</span>
      </button>
    </div>
  </div>

  <div class="canvas-container">
    <div class="canvas-wrapper">
      <canvas id="canvas"></canvas>
      <!-- Text input overlay -->
      <div id="textInputContainer" class="text-input-container" style="display: none;">
        <input type="text" id="textInput" class="text-input" placeholder="Type text...">
      </div>
    </div>
  </div>

  <div id="loading" class="loading">
    <div class="spinner"></div>
    <p>Loading image...</p>
  </div>

  <div id="error" class="error-message"></div>

  <!-- Draft Recovery Modal -->
  <div id="draftModal" class="modal" style="display: none;">
    <div class="modal-content">
      <h2>Unsaved Work Found</h2>
      <p>You have unsaved edits from <span id="draftTime"></span>. Would you like to continue where you left off?</p>
      <div class="modal-actions">
        <button class="action-btn" id="restoreDraftBtn">Restore Draft</button>
        <button class="action-btn secondary" id="discardDraftBtn">Use New Screenshot</button>
      </div>
    </div>
  </div>

  <!-- Storage Error Modal -->
  <div id="storageErrorModal" class="modal" style="display: none;">
    <div class="modal-content modal-error">
      <div class="modal-icon error-icon">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
          <line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/>
        </svg>
      </div>
      <h2>Storage Full</h2>
      <p class="storage-error-message">Storage quota exceeded. Please download your image and clear the draft.</p>
      <div class="modal-actions vertical">
        <button class="action-btn" id="storageDownloadBtn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/>
          </svg>
          Download Image
        </button>
        <button class="action-btn secondary danger" id="storageClearBtn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
          </svg>
          Clear Draft
        </button>
        <button class="action-btn text-btn" id="storageDismissBtn">Dismiss</button>
      </div>
    </div>
  </div>

  <!-- Large Image Warning Modal -->
  <div id="largeImageModal" class="modal" style="display: none;">
    <div class="modal-content modal-warning">
      <div class="modal-icon warning-icon">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/>
        </svg>
      </div>
      <h2>Large Image</h2>
      <p class="large-image-message">This image is very large and may cause storage issues.</p>
      <p class="large-image-info">Size: <span class="large-image-size">0 MB</span></p>
      <div class="modal-actions">
        <button class="action-btn" id="largeImageContinueBtn">Continue Anyway</button>
        <button class="action-btn secondary" id="largeImageScaleBtn" style="display: none;">Scale Down</button>
      </div>
    </div>
  </div>

  <!-- Tooltip element -->
  <div id="tooltip" class="tooltip" role="tooltip"></div>

  <script type="module" src="editor.js"></script>
</body>
</html>
